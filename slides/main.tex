\documentclass{beamer}

\usepackage{agda}
\usepackage{apacite}
\usepackage{catchfilebetweentags}
\usepackage{changepage}
\usepackage{babel}

\usepackage{graphicx}

\usepackage[autostyle=true,french=guillemets,maxlevel=3]{csquotes}

\graphicspath{ {images/} }
 
\usetheme{Frankfurt}

\DeclareQuoteStyle{english}
  {\em}
	{\em}
	{\textquotedblleft\em}
	{\em\textquotedblright}

 
%Information to be included in the title page:
\title{Uma versão simplificada do Bitcoin, \\
  implementada em Agda}
\author[Guilherme, Flávio]{Guilherme Horta Alvares da Silva \\
  Orientador: Flávio Codeço Coelho}
\institute{Fundação Getulio Vargas}
\date{2019}

 
\begin{document}
 
\frame{\titlepage}

\begin{frame}
  \frametitle{Uma versão simplificada do Bitcoin, implementada em Agda}
\begin{itemize}
  \item Objetivo
  \item Justificativa
  \item Introdução
  \begin{itemize}
    \item Criptomoedas
    \item Agda
    \item Bugs em criptomoedas
  \end{itemize}
  \item Trabalho executado
  \item Próximos passos
  \item Referências Bibliográficas
\end{itemize}
\end{frame}

\section{Objetivo}

 \begin{frame}
\frametitle{Objetivo}
\begin{itemize}
  \item Programar uma criptomoeda (similar ao Bitcoin) em Agda, que é uma linguagem com tipos dependentes.
    \includegraphics[width=8cm, height=5cm]{TwoBitcoins}
\end{itemize}
\end{frame}
 
\section{Justificativa}

\begin{frame}
\frametitle{Justificativa}
\begin{itemize}
    \item Programar um protocólo de criptomoedas livre de erros (bugs)
    \item Utilizar Agda permite, além da programação da criptomoeda, especificar como ela deve funcionar
      \cite{norell2008dependently}
\end{itemize}
\end{frame}

\section{Linguagem Funcional}

\begin{frame}
\frametitle{Linguagem Funcional}
\begin{itemize}
  \item Em linguagens funcionais, toda função retorna o mesmo output para o mesmo input.
  \item Em Agda, toda função é total e ela sempre termina.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Efeitos Colaterais}
\begin{itemize}
  \item Para Agda ser utilizada como um programa, ela tem que lidar com o sistema operacional.
    Operação chamada de IO (Input Output).
  \item Várias pesquisas estão sendo feitas para minimizar os efeitos colaterais do IO.
  \item Lógica linear é usada para lidar com recursos, como abrir arquivos.
  \item Efeitos algébricos são utilizados para distinguir os diferentes tipos de efeitos
    relacionados ao sistema operacional.
\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Efeitos Colaterais}
\begin{itemize}
  \item Frontend e backend de serviços estão sendo programados na mesma linguagem funcional
    para minimizar os efeitos colaterais.
  \item Haxl, usado no Facebook, é uma ferramenta que faz o cache das operações IO para
    fácil debug, log e teste.
  \item Facebook também faz Hot Swapping de forma funcional.
    Ou seja, ele não reinicia o processo para iniciar um novo.
    Algo que já era comum em Lisp.
  \item Sistemas distribuidos já estão sendo completamente descritos por meio de linguagens funcionais.
    Whatsapp utiliza Elixir como linguagem.
\end{itemize}
\end{frame}

\section{Industria}

\begin{frame}
  \frametitle{Beneficios}
  \begin{itemize}
    \item Por causa dos inúmeros benefícios das linguagens funcionais,
      elas estão sendo cada vez mais utilizadas na indústria.
    \item Garantem corretude de software.
      É de fácil reproducibilidade, testabilidade e é mais fácil de debugar.
    \item Entretanto, elas são mais difíceis de serem aprendidas.
      Necessitam alto grau de abstração e
      é mais difícil de encontrar mão de obra.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Empresas}
    \includegraphics[width=2.5cm, height=2.5cm]{companies/Galois}
    \includegraphics[width=2cm, height=2cm]{companies/barclays}
    \includegraphics[width=2cm, height=2cm]{companies/fb}
    \includegraphics[width=2cm, height=2cm]{companies/whatsapp}
    \includegraphics[width=6cm, height=2cm]{companies/jane_street}
\end{frame}

\begin{frame}
  \frametitle{Criptomoedas}
    \includegraphics[width=6cm, height=4cm]{crypto/cardano}
    \includegraphics[width=4cm, height=4cm]{crypto/rchain}
    \includegraphics[width=6cm, height=4cm]{crypto/t3-tezos}
\end{frame}

\section{Criptomoedas}

\begin{frame}
  \frametitle{Criptomoeda}
\begin{itemize}
    \item Uma criptomoeda é um meio de troca descentralizado que se utiliza da tecnologia de blockchain e da criptografia para assegurar a validade das transações e a criação de novas unidades da moeda
    \item O bitcoin é considerado a primeira moeda digital mundial descentralizada, constituindo um sistema econômico alternativo (\foreignquote{english}{peer-to-peer electronic cash system}) e responsável pelo ressurgimento do sistema bancário livre
      \cite{nakamoto2008bitcoin}
    \item O Bitcoin permite transações financeiras sem intermediários, mas verificadas por todos usuários (nodos da rede). Estas transações são gravadas em um banco de dados distribuídos (uma rede descentralizada), chamado de \foreignquote{english}{blockchain}.
    \end{itemize}
\end{frame}

\begin{frame}
\frametitle{Blockchain}
\includegraphics[width=11cm, height=8cm]{blockchain1}
\end{frame}

\begin{frame}
\frametitle{Blockchain}
\includegraphics[width=11cm, height=8cm]{blockchain2}
\end{frame}

\begin{frame}
\frametitle{Blockchain}
\includegraphics[width=11cm, height=8cm]{blockchain3}
\end{frame}
 
\section{Agda}

 \begin{frame}{Agda}
 \begin{itemize}
   \item Linguagem funcional com sistema de tipos expressivos capazes de representar as especificações
     \item Possibilita especificar e programar em um único lugar
     \item O processo de verificação acontece no compilador
 \end{itemize}
 \end{frame}
 
 \begin{frame}{Agda --- II}
 \begin{itemize}
     \item A linguagem não possui \foreignquote{english}{Built-in} como em Python
     \item Tipos como inteiros, ponto flutuantes, \foreignquote{english}{strings} e vetores devem ser definidos pelo próprio usuário
     \item Tipos em Agda são uma generalização de tipos de dados algébricos encontrados em Haskell e ML
 \end{itemize}
 \end{frame}

\section{Lambda Calculus}

 \begin{frame}{Identidade}
  \begin{itemize}
    \item Agda utiliza alguns conceitos do Lamdba Calculus.
    \ExecuteMetaData[latex/lambdaCalculus.tex]{Id}
    \ExecuteMetaData[latex/lambdaCalculus.tex]{Id2}
  \end{itemize}
 \end{frame}
 
 \begin{frame}{Booleanos}
  \begin{itemize}
    \item Definição de booleanos
      \ExecuteMetaData[latex/lambdaCalculus.tex]{trueFalse}
  \end{itemize}
  \end{frame}

 \begin{frame}{Números naturais}
  \begin{itemize}
    \item Definição de números naturais
      \ExecuteMetaData[latex/lambdaCalculus.tex]{naturals}
  \end{itemize}
  \end{frame}

 \begin{frame}{Zero}
      \ExecuteMetaData[latex/lambdaCalculus.tex]{isZero}
  \end{frame}

 \begin{frame}{Soma}
      \ExecuteMetaData[latex/lambdaCalculus.tex]{plus}
      \ExecuteMetaData[latex/lambdaCalculus.tex]{onePone}
  \end{frame}

 \begin{frame}{Lista}
    \ExecuteMetaData[latex/lambdaCalculus.tex]{list}
    \ExecuteMetaData[latex/lambdaCalculus.tex]{sumList}
  \end{frame}

 \begin{frame}{Soma}
  \begin{itemize}
    \item Definição de tipos de soma
      \ExecuteMetaData[latex/lambdaCalculus.tex]{either}
  \end{itemize}
  \end{frame}

 \begin{frame}{Tipo soma}
    \ExecuteMetaData[latex/lambdaCalculus.tex]{eitherRes}
  \end{frame}

 \begin{frame}{Tuplas}
  \begin{itemize}
    \item Definição de tupla
      \ExecuteMetaData[latex/lambdaCalculus.tex]{tuple}
      \ExecuteMetaData[latex/lambdaCalculus.tex]{tupleExamples}
  \end{itemize}
  \end{frame}

 \begin{frame}{Adição de tuplas}
    \ExecuteMetaData[latex/lambdaCalculus.tex]{tupleAdd}
  \end{frame}

\section{Agda}

\begin{frame}{Agda --- IV}
 \begin{itemize}
   \item Adição em Agda:
 \end{itemize}
 %% \ExecuteMetaData[latex/Code.tex]{plus}
\end{frame}

\begin{frame}{Agda --- V}
 \begin{itemize}
   \item Um tipo é dependente se este depende de um valor.
   \item Exemplo --- Listas indexadas por seu tamanho:
 \end{itemize}
 %% \ExecuteMetaData[latex/Code.tex]{vector}
\end{frame}

\begin{frame}{Agda --- VI}
 \begin{itemize}
   \item Modo seguro de remover primeiro elemento do vetor:
     %% \ExecuteMetaData[latex/Code.tex]{vectorhead}
   \item Função zip com 2 vetores de mesmo tamanho:
     %% \ExecuteMetaData[latex/Code.tex]{zipWith}
 \end{itemize}
\end{frame}

\section{Bug}

 \begin{frame}
   \frametitle{Maleabilidade de transacao}
\begin{itemize}
  \item Nesse tipo de bug, é possível alterar o hash da transação depois que ela foi enviada
  \item Todos os dados para calcular do hash não eram previamente calculados. Assim, o minerador poderia alterar o hash da transação
  \item O ataque consistiria de um usuário enviar uma transação e ela não ser confirmada pelo sistema.
    Logo em seguida, este mesmo usuário enviaria uma outra transação. Desta forma, ele faria duas transações com a mesma moeda
  \item Este tipo de BUG pode ser evitado usando tipos dependentes. Colocando como característica da transação, o fato de seu ID ser único
\end{itemize}
\end{frame}

\begin{frame}
  \frametitle{DAO Bug}
  \begin{itemize}
    \item \foreignquote{english}{Bug} que aconteceu em um cripto-contrato da rede Ethereum com um prejuízo de mais do que 250 milhões de dólares
      \cite{wood2014ethereum}
    \item No cripto-contrato, existia uma função recursiva que não terminava. Ou seja, o usuário enviava uma quantidade de ethereum, depois acontecia um \foreignquote{english}{loop} infinito e só depois era feito a atualização do seu balanço
    \item Em Agda, esse tipo de bug seria evitado, pois é necessário provar que a função termina. Logo, \foreignquote{english}{loops} infinitos não são possíveis em Agda
  \end{itemize}
\end{frame}

\section{Trabalho executado}

\begin{frame}{Trabalho já executado}
  \begin{itemize}
    \item A criptomoeda já foi programada em Python
    \item Parte da \foreignquote{english}{blockchain} já foi programada em Agda
    \item As transações já foram descritas na literatura: UTXO (\foreignquote{english}{Unspent transaction output}) \\
      \cite{setzer2018modelling}
  \end{itemize}
\end{frame}

\begin{frame}{Blockchain em Agda}
  \begin{adjustwidth}{-3.5em}{-2em} \fontsize{8}{11}
     %% \ExecuteMetaData[latex/Code.tex]{blockchain}
  \end{adjustwidth}
\end{frame}
  
\section{Próximos Passos}

\begin{frame}{Próximos passos}
  \begin{itemize}
    \item Anexar a \foreignquote{english}{blockchain} às transações já programadas em Agda
    \item Provar alguns teoremas relacionados à criptomoeda
  \end{itemize}
\end{frame}

\begin{frame}{Teoremas}
  \begin{itemize}
    \item Se uma transação tem algum \foreignquote{english}{output} que não foi usado em nenhuma outra transação, 
      então ela deve estar na lista de \foreignquote{english}{outputs transactions} não usados
    \item Se uma transação tem algum \foreignquote{english}{output} que foi gasto, ele não pode ser usado novamente
      \item Provar que transações e mensagens ids são únicos
  \end{itemize}
\end{frame}

\begin{frame}{O que não será realizado}
  \begin{itemize}
    \item Modelo de criptomoeda em que é possível algum tipo de \foreignquote{english}{fork}. Por exemplo, no bitcoin, é possível que exista algum tipo de \foreignquote{english}{fork} temporário
    \item \foreignquote{english}{Pool} de transações. Sua utilidade é apenas para guardar as transações que ainda não foram adicionadas a \foreignquote{english}{blockchain}
    Isso pode ser feito fora do protocolo principal
  \item Otimização e protocolos RPC (\foreignquote{english}{Remote Procedure Call}). O objetivo do projeto é definir as propriedades da criptomoeda, não como ela será implementada e usada
  \end{itemize}
\end{frame}

\section{Bibliografia}

 \begin{frame}{Livros}
    \includegraphics[width=4cm, height=6cm]{TDD}
    \includegraphics[width=4cm, height=6cm]{ProgrammingBitcoin}
 \end{frame}
  

\begin{frame}{Referências Bibliográficas}
  \bibliographystyle{apacite}
  \bibliography{References}
\end{frame}

\end{document}
