\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Ledger}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Prelude}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Utils}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Crypto}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Transactions}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{RawTransactions}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{TXTree}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{RawTXTree}\<%
\end{code}

%<*ledgernoid>
\begin{code}%
\>[0]\AgdaFunction{ledgerOutNoId}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXField}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Address}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
\>[0]\AgdaFunction{ledgerOutNoId}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
\>[0]\AgdaFunction{ledgerOutNoId}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{output}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaField{TXField.address}\AgdaSpace{}%
\AgdaBound{output}\AgdaSpace{}%
\AgdaOperator{\AgdaField{==}}\AgdaSpace{}%
\AgdaBound{addr}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{TXField.amount}\AgdaSpace{}%
\AgdaBound{output}\AgdaSpace{}%
\AgdaOperator{\AgdaField{+}}\AgdaSpace{}%
\AgdaFunction{ledgerOutNoId}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{addr}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ledgerOutNoId}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{addr}\<%
\end{code}
%</ledgernoid>

%<*ledgerout>
\begin{code}%
\>[0]\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Address}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
\>[0]\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
\>[0]\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{output}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaField{TXFieldWithId.address}\AgdaSpace{}%
\AgdaBound{output}\AgdaSpace{}%
\AgdaOperator{\AgdaField{==}}\AgdaSpace{}%
\AgdaBound{addr}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{TXFieldWithId.amount}\AgdaSpace{}%
\AgdaBound{output}\AgdaSpace{}%
\AgdaOperator{\AgdaField{+}}\AgdaSpace{}%
\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{addr}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{addr}\<%
\end{code}
%</ledgerout>

%<*ledgertree>
\begin{code}%
\>[0]\AgdaFunction{ledgerTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{rawTXTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{RawTXTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Address}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
\>[0]\AgdaFunction{ledgerTree}\AgdaSpace{}%
\AgdaBound{txTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaField{outputs}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{open}\AgdaSpace{}%
\AgdaModule{RawTXTree.RawTXTree}\AgdaSpace{}%
\AgdaBound{txTree}\<%
\end{code}
%</ledgertree>

%<*deltarawtx>
\begin{code}%
\>[0]\AgdaFunction{deltaRawTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{RawTX}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Address}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Int}\<%
\\
\>[0]\AgdaFunction{deltaRawTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{pos}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{∘}}\AgdaSpace{}%
\AgdaFunction{ledgerOut}\AgdaSpace{}%
\AgdaBound{outputs}\<%
\\
\>[0]\AgdaFunction{deltaRawTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{inputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{pos}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\AgdaSpace{}%
\AgdaFunction{ledgerOutNoId}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{addr}\<%
\\
\>[0]\AgdaFunction{deltaRawTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{inputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{time}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{position}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{amount}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{msg}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{;}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaField{signature}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{publicKey}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{pk}\AgdaSpace{}%
\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaOperator{\AgdaInductiveConstructor{::}}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{\})}\AgdaSpace{}%
\AgdaBound{addr}\<%
\\
%
\>[2]\AgdaKeyword{with}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaOperator{\AgdaField{==}}\AgdaSpace{}%
\AgdaPostulate{publicKey2Address}\AgdaSpace{}%
\AgdaBound{pk}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{deltaRawTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{inputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaBound{addr}\AgdaSpace{}%
\AgdaOperator{\AgdaField{{-}}}\AgdaSpace{}%
\AgdaInductiveConstructor{pos}\AgdaSpace{}%
\AgdaBound{amount}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[10]\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{deltaRawTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaKeyword{record}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaSpace{}%
\AgdaField{inputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{;}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{\}))}\AgdaSpace{}%
\AgdaBound{addr}\<%
\end{code}
%</deltarawtx>
