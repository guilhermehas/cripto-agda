\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{Blockchain}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Prelude}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Utils}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Cripto}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Transactions}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{TXTree}\<%
\end{code}

%<*nexttree>
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaSymbol{\{}\AgdaBound{block₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block₂}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaInductiveConstructor{firstTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaBound{txTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaBound{txTree}\AgdaSpace{}%
\AgdaBound{txTree}\<%
\\
%
\>[2]\AgdaInductiveConstructor{nextTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaSymbol{\{}\AgdaBound{block₂}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block₂}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaSymbol{(}\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outputTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{proofLessQtTX}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaDatatype{Either}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\end{code}
%</nexttree>

%<*firsttreeinblock>
\begin{code}%
\>[0]\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{⊤}\<%
\\
\>[0]\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
\>[0]\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
\>[0]\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{⊤}\<%
\end{code}
%</firsttreeinblock>

%<*isfirsttreeinblock>
\begin{code}%
\>[0]\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\<%
\\
\>[0]\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\<%
\end{code}
%</isfirsttreeinblock>

%<*coinbasetree>
\begin{code}%
\>[0]\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
\>[0]\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
\>[0]\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{⊤}\<%
\end{code}
%</coinbasetree>

%<*block>
\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{Block}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{blockc}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{nxTree}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaBound{txTree₂}\<%
\\
%
\>[4]\AgdaField{fstBlock}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaBound{txTree₁}\<%
\\
%
\>[4]\AgdaField{sndBlockCoinbase}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaBound{txTree₂}\<%
\end{code}
%</block>
\begin{code}%
\>[0]\<%
\\
\>[0]\AgdaFunction{fstTree→coinbase}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{proofLessQtTX}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaDatatype{Either}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{)\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{fstTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaBound{tree}\<%
\\
\>[0]\AgdaFunction{fstTree→coinbase}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{genesisTree}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{fstTree→coinbase}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{()}\<%
\\
\>[0]\AgdaFunction{fstTree→coinbase}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{unit}\<%
\\
\>[0]\<%
\end{code}
%<*blockchain>
\begin{code}%
\>[0]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{Blockchain}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Block}\AgdaSpace{}%
\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}%
\>[440I]\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
\>[.]\<[440I]%
\>[4]\AgdaInductiveConstructor{fstBlock}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{time₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{qtTransactions₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[6]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Block}\AgdaSpace{}%
\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Blockchain}\AgdaSpace{}%
\AgdaBound{block}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaInductiveConstructor{addBlock}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{\{}\AgdaBound{block{-}p₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{time{-}p₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputs{-}p₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{totalFees{-}p₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{qtTransactions{-}p₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{txTree{-}p₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time{-}p₁}\AgdaSpace{}%
\AgdaBound{block{-}p₁}\AgdaSpace{}%
\AgdaBound{outputs{-}p₁}\AgdaSpace{}%
\AgdaBound{totalFees{-}p₁}\AgdaSpace{}%
\AgdaBound{qtTransactions{-}p₁}\AgdaSymbol{\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[6]\AgdaSymbol{\{}\AgdaBound{time{-}p₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputs{-}p₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{totalFees{-}p₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{qtTransactions{-}p₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{txTree{-}p₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time{-}p₂}\AgdaSpace{}%
\AgdaBound{block{-}p₁}\AgdaSpace{}%
\AgdaBound{outputs{-}p₂}\AgdaSpace{}%
\AgdaBound{totalFees{-}p₂}\AgdaSpace{}%
\AgdaBound{qtTransactions{-}p₂}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{block{-}p}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Block}\AgdaSpace{}%
\AgdaBound{txTree{-}p₁}\AgdaSpace{}%
\AgdaBound{txTree{-}p₂}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{blockchain}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Blockchain}\AgdaSpace{}%
\AgdaBound{block{-}p}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time{-}p₂}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time{-}p₂}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block{-}p₁}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outputs{-}p₂}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{txTree{-}p₂}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{proofLessQtTX}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaDatatype{Either}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions{-}p₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\<%
\\
%
\>[10]\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{)\}}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[6]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Block}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{txTree{-}p₂}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Blockchain}\AgdaSpace{}%
\AgdaBound{block}\<%
\end{code}
%</blockchain>

%<*rawblock>
\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{RawBlock}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{rawBlockc}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaField{time}\AgdaSymbol{\}}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{outputs}\AgdaSymbol{\}}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{totalFees}\AgdaSymbol{\}}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{qtTransactions}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{tree}\AgdaSymbol{\}}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaField{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaField{totalFees}\AgdaSpace{}%
\AgdaField{qtTransactions}\<%
\\
%
\>[4]\AgdaField{rawBlock}%
\>[21]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Block}\AgdaSpace{}%
\AgdaField{tree}\AgdaSpace{}%
\AgdaBound{tree₂}\<%
\end{code}
%</rawblock>

%<*iscoinbase>
\begin{code}%
\>[0]\AgdaFunction{isCoinbaseTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{coinbaseTree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{isCoinbaseTree}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaFunction{isCoinbaseTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ}\AgdaSpace{}%
\AgdaBound{x}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{x}\<%
\\
\>[0]\AgdaFunction{isCoinbaseTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaInductiveConstructor{tt}\<%
\end{code}
%</iscoinbase>

%<*fsttree>
\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{fstTree}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreec}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaField{time}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{outputs}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{totalFees}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{qtTransactions}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{tree}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaField{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaField{totalFees}\AgdaSpace{}%
\AgdaField{qtTransactions}\<%
\\
%
\>[4]\AgdaField{nxTree}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaField{tree}\AgdaSpace{}%
\AgdaBound{txTree₂}\<%
\\
%
\>[4]\AgdaField{fstBlockc}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaField{tree}\<%
\end{code}
%</fsttree>

\begin{code}%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{fstTree₂}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreec₂}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaField{block₂}\AgdaSymbol{\}}%
\>[26]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{time}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{outputs}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{totalFees}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{qtTransactions}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaField{tree}\AgdaSymbol{\}}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaField{time}\AgdaSpace{}%
\AgdaField{block₂}\AgdaSpace{}%
\AgdaField{outputs}\AgdaSpace{}%
\AgdaField{totalFees}\AgdaSpace{}%
\AgdaField{qtTransactions}\<%
\\
%
\>[4]\AgdaField{eq}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaField{block₂}\<%
\\
%
\>[4]\AgdaField{nxTree}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaField{tree}\AgdaSpace{}%
\AgdaBound{txTree₂}\<%
\\
%
\>[4]\AgdaField{fstBlockc}%
\>[25]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaField{tree}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{fstTree₂→fstTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{fTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{fstTree₂}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{fstTree}\AgdaSpace{}%
\AgdaBound{txTree₂}\<%
\\
\>[0]\AgdaFunction{fstTree₂→fstTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{fstTreec₂}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fstBlockc}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreec}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fstBlockc}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{fstTreeChange}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreeChangedc}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaField{tree}\AgdaSymbol{\}}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\<%
\\
%
\>[4]\AgdaField{ftree}%
\>[16]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{fstTree}\AgdaSpace{}%
\AgdaField{tree}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{changeBlockType}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{block₂}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{txTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{fstTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{fstTree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{block₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{fstTreeChange}\AgdaSpace{}%
\AgdaBound{block₂}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\<%
\\
\>[0]\AgdaFunction{changeBlockType}\AgdaSpace{}%
\AgdaBound{fstTree}\AgdaSpace{}%
\AgdaInductiveConstructor{refl}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreeChangedc}\AgdaSpace{}%
\AgdaBound{fstTree}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{record}\AgdaSpace{}%
\AgdaRecord{TXChange}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{proofLess}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Either}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[2]\AgdaKeyword{constructor}\AgdaSpace{}%
\AgdaInductiveConstructor{TXChangedc}\<%
\\
%
\>[2]\AgdaKeyword{field}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaField{fTree}%
\>[26]\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{fstTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLess}\AgdaSymbol{)}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{changeTXType}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[3]\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{outputTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{tree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{nextTXTree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tree₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{fstBlockc}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{firstTreesInBlock}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaBound{tree₂}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{proofLess}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Either}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{))}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{eq}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{block}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{TXChange}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tree₂}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLess}\<%
\\
\>[0]\AgdaFunction{changeTXType}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fblock}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proof}\AgdaSpace{}%
\AgdaBound{eq}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{let}%
\>[943I]\AgdaBound{nxTX}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{nextTX}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proof}\<%
\\
\>[.]\<[943I]%
\>[6]\AgdaBound{ftree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{fstTree₂→fstTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{fstTreec₂}\AgdaSpace{}%
\AgdaBound{eq}\AgdaSpace{}%
\AgdaBound{nxTX}\AgdaSpace{}%
\AgdaBound{fblock}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{in}\AgdaSpace{}%
\AgdaInductiveConstructor{TXChangedc}\AgdaSpace{}%
\AgdaBound{ftree}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{fstTreeBlock}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{fstTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{fstTree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Nat}\<%
\\
\>[0]\AgdaFunction{fstTreeBlock}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{block}\<%
\end{code}

%<*firsttree>
\begin{code}%
\>[0]\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaRecord{fstTree}\AgdaSpace{}%
\AgdaBound{tree}\<%
\\
\>[0]\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{firstTX}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{unit}\<%
\\
\>[0]\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block₂}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{isFirstTreeInBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaBound{isFirst}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{firstTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaBound{isFirst}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaBound{¬first}\AgdaSpace{}%
\AgdaKeyword{with}\AgdaSpace{}%
\AgdaKeyword{let}\AgdaSpace{}%
\AgdaBound{fstTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaKeyword{in}\AgdaSpace{}%
\AgdaBound{block₂}\AgdaSpace{}%
\AgdaOperator{\AgdaField{==}}\AgdaSpace{}%
\AgdaBound{block₁}\<%
\\
\>[0]\AgdaSymbol{...}%
\>[6]\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaBound{eq}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[1037I]\AgdaKeyword{let}%
\>[1038I]\AgdaBound{ftree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaBound{tree}\<%
\\
\>[.]\<[1038I]%
\>[21]\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fstTree.nxTree}\AgdaSpace{}%
\AgdaBound{ftree}\<%
\\
%
\>[21]\AgdaBound{fstBlock}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fstTree.fstBlockc}\AgdaSpace{}%
\AgdaBound{ftree}\<%
\\
%
\>[21]\AgdaBound{chgType}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{changeTXType}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fstBlock}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSpace{}%
\AgdaBound{eq}\<%
\\
\>[.]\<[1037I]%
\>[17]\AgdaKeyword{in}\AgdaSpace{}%
\AgdaField{TXChange.fTree}\AgdaSpace{}%
\AgdaBound{chgType}\<%
\\
\>[0]\AgdaSymbol{...}%
\>[6]\AgdaSymbol{|}%
\>[1057I]\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaBound{¬eq}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{⊥{-}elim}\AgdaSpace{}%
\AgdaPostulate{impossible}\<%
\\
\>[1057I][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaKeyword{where}\AgdaSpace{}%
\AgdaKeyword{postulate}\AgdaSpace{}%
\AgdaPostulate{impossible}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\end{code}
%</firsttree>

%<*treeblock>
\begin{code}%
\>[0]\AgdaFunction{txTree→Block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Dec}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaRecord{RawBlock}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{txTree→Block}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ\{(}\AgdaInductiveConstructor{rawBlockc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{sndBlockCoinbase}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{sndBlockCoinbase}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaFunction{txTree→Block}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{isCoinbaseTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{no}%
\>[1102I]\AgdaBound{¬isCoinbase}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[.]\<[1102I]%
\>[9]\AgdaInductiveConstructor{no}\AgdaSpace{}%
\AgdaSymbol{λ\{}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rawBlockc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{coinbaseTree}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaBound{¬isCoinbase}\AgdaSpace{}%
\AgdaBound{coinbaseTree}\AgdaSymbol{\}}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaBound{isCoinbase}\AgdaSpace{}%
\AgdaSymbol{=}%
\>[1117I]\AgdaKeyword{let}%
\>[1118I]\AgdaBound{fTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\\
\>[.]\<[1118I]%
\>[27]\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fstTree.nxTree}\AgdaSpace{}%
\AgdaBound{fTree}\<%
\\
%
\>[27]\AgdaBound{fBlock}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaField{fstTree.fstBlockc}\AgdaSpace{}%
\AgdaBound{fTree}\<%
\\
\>[.]\<[1117I]%
\>[23]\AgdaKeyword{in}\AgdaSpace{}%
\AgdaInductiveConstructor{yes}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{rawBlockc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fBlock}\AgdaSpace{}%
\AgdaBound{isCoinbase}\AgdaSymbol{))}\<%
\end{code}
%</treeblock>


\begin{code}%
\>[0]\AgdaSymbol{\{{-}\#}\AgdaSpace{}%
\AgdaKeyword{TERMINATING}\AgdaSpace{}%
\AgdaSymbol{\#{-}\}}\<%
\end{code}

%<*blockblockchain>
\begin{code}%
\>[0]\AgdaFunction{block→blockchain}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{\{}\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₁}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₁}\AgdaSpace{}%
\AgdaBound{totalFees₁}\AgdaSpace{}%
\AgdaBound{qtTransactions₁}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{\{}\AgdaBound{txTree₂}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time₂}\AgdaSpace{}%
\AgdaBound{block₁}\AgdaSpace{}%
\AgdaBound{outputs₂}\AgdaSpace{}%
\AgdaBound{totalFees₂}\AgdaSpace{}%
\AgdaBound{qtTransactions₂}\AgdaSymbol{\}}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{Block}\AgdaSpace{}%
\AgdaBound{txTree₁}\AgdaSpace{}%
\AgdaBound{txTree₂}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Blockchain}\AgdaSpace{}%
\AgdaBound{block}\<%
\\
\>[0]\AgdaFunction{block→blockchain}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{genesisTree}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fstBlock₁}\AgdaSpace{}%
\AgdaBound{sndBlockCoinbase}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
%
\>[2]\AgdaInductiveConstructor{fstBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaInductiveConstructor{unit}\AgdaSpace{}%
\AgdaBound{sndBlockCoinbase}\AgdaSymbol{)}\<%
\\
\>[0]\AgdaFunction{block→blockchain}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{\}}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fstBlock₁}\AgdaSpace{}%
\AgdaBound{sndBlockCoinbase}\AgdaSymbol{)}\<%
\\
%
\>[2]\AgdaKeyword{with}\AgdaSpace{}%
\AgdaFunction{firstTree}\AgdaSpace{}%
\AgdaBound{tree}\<%
\\
\>[0]\AgdaSymbol{...}\AgdaSpace{}%
\AgdaSymbol{|}\AgdaSpace{}%
\AgdaInductiveConstructor{fstTreec}\AgdaSpace{}%
\AgdaBound{nxTree₁}\AgdaSpace{}%
\AgdaBound{fstBlockc}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{addBlock}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaSymbol{(}\AgdaFunction{block→blockchain}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaBound{nxTree₁}\AgdaSpace{}%
\AgdaBound{fstBlockc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{fstTree→coinbase}\AgdaSpace{}%
\AgdaBound{fstBlock₁}\AgdaSymbol{)))}\<%
\\
%
\>[2]\AgdaSymbol{(}\AgdaInductiveConstructor{blockc}\AgdaSpace{}%
\AgdaBound{nxTree}\AgdaSpace{}%
\AgdaBound{fstBlock₁}\AgdaSpace{}%
\AgdaBound{sndBlockCoinbase}\AgdaSymbol{)}\<%
\end{code}
%</blockblockchain>
