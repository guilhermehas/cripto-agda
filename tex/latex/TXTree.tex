\begin{code}%
\>[0]\AgdaKeyword{module}\AgdaSpace{}%
\AgdaModule{TXTree}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Prelude}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Utils}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Crypto}\<%
\\
\>[0]\AgdaKeyword{open}\AgdaSpace{}%
\AgdaKeyword{import}\AgdaSpace{}%
\AgdaModule{Transactions}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{totalQtSub1}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\<%
\\
\>[0]\AgdaFunction{totalQtSub1}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{9}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{totalQt}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\<%
\\
\>[0]\AgdaFunction{totalQt}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{tQtTxs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
\>[0]\AgdaFunction{tQtTxs}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{Fin}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{\$}}\AgdaSpace{}%
\AgdaFunction{totalQt}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
\>[0]\AgdaFunction{blockReward}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Nat}\<%
\\
\>[0]\AgdaFunction{blockReward}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaNumber{100}\<%
\end{code}

%<*TXTree>
\begin{code}%
\>[0]\AgdaKeyword{mutual}\<%
\\
\>[0][@{}l@{\AgdaIndent{0}}]%
\>[2]\AgdaKeyword{data}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{)}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\\[\AgdaEmptyExtraSkip]%
%
\>[4]\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{nat}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{[]}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
%
\>[4]\AgdaInductiveConstructor{txtree}%
\>[16]\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{outputTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{tree}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tree}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{proofLessQtTX}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaDatatype{Either}\<%
\\
\>[8][@{}l@{\AgdaIndent{0}}]%
\>[10]\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\<%
\\
%
\>[10]\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{))}\<%
\\
%
\>[6]\AgdaSymbol{→}%
\>[102I]\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sucTime}\AgdaSpace{}%
\AgdaBound{time}\AgdaSymbol{)}\<%
\\
\>[.]\<[102I]%
\>[8]\AgdaSymbol{(}\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaFunction{inputsTX}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{++}}\AgdaSpace{}%
\AgdaFunction{VectorOutput→List}\AgdaSpace{}%
\AgdaBound{outputTX}\AgdaSymbol{)}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaFunction{incFees}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{incQtTx}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSpace{}%
\AgdaBound{proofLessQtTX}\AgdaSymbol{)}\<%
\end{code}
%</TXTree>

%<*TX>
\begin{code}%
%
\>[2]\AgdaKeyword{data}%
\>[114I]\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
\>[.]\<[114I]%
\>[7]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outAmount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[7]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{:}%
\>[135I]\AgdaSymbol{(}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
\>[.]\<[135I]%
\>[6]\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{outAmount}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\AgdaSpace{}%
\AgdaKeyword{where}\<%
\\
%
\>[4]\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{SubInputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{SubList}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{outAmount}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{txSigned}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaRecord{TXSigned}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sub→list}\AgdaSpace{}%
\AgdaBound{SubInputs}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\<%
\\
%
\>[4]\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaSymbol{(}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{outAmount}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{(}\AgdaBound{pAmountFee}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaBound{outAmount}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{out≡Fee}}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{+RewardBlock}}\AgdaSpace{}%
\AgdaBound{block}\AgdaSymbol{)}\<%
\\
%
\>[6]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\<%
\end{code}
%</TX>

%<*isCoinBase>
\begin{code}%
%
\>[2]\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
%
\>[2]\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaDatatype{⊥}\<%
\\
%
\>[2]\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}%
\>[34]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaRecord{⊤}\<%
\end{code}
%</isCoinBase>

%<*nextBlock>
\begin{code}%
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{Nat}\<%
\\
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{block}\<%
\\
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{block}\<%
\\
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaInductiveConstructor{genesisTree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\\
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{block}\<%
\\
%
\>[2]\AgdaFunction{nextBlock}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txtree}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaBound{block}\<%
\end{code}
%</nextBlock>

%<*inputsTX>
\begin{code}%
%
\>[2]\AgdaFunction{inputsTX}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\<%
\\
%
\>[2]\AgdaFunction{inputsTX}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{SubInputs}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaFunction{list{-}sub}\AgdaSpace{}%
\AgdaBound{SubInputs}\<%
\\
%
\>[2]\AgdaFunction{inputsTX}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaBound{inputs}\<%
\end{code}
%</inputsTX>

%<*incQtTx>
\begin{code}%
%
\>[2]\AgdaFunction{incQtTx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{proofLessQtTX}\AgdaSpace{}%
\AgdaSymbol{:}\<%
\\
\>[4][@{}l@{\AgdaIndent{0}}]%
\>[6]\AgdaDatatype{Either}\<%
\\
\>[6][@{}l@{\AgdaIndent{0}}]%
\>[8]\AgdaSymbol{(}\AgdaDatatype{IsTrue}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaPrimitive{lessNat}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaFunction{totalQtSub1}\AgdaSymbol{))}\<%
\\
%
\>[8]\AgdaSymbol{(}\AgdaFunction{isCoinbase}\AgdaSpace{}%
\AgdaBound{tx}\AgdaSymbol{))}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\<%
\\
%
\>[2]\AgdaFunction{incQtTx}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qt}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{left}\AgdaSpace{}%
\AgdaBound{pLess}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaFunction{natToFin}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{suc}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{finToNat}\AgdaSpace{}%
\AgdaBound{qt}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{\{\{}\AgdaBound{pLess}\AgdaSymbol{\}\}}\<%
\\
%
\>[2]\AgdaFunction{incQtTx}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qt}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{right}\AgdaSpace{}%
\AgdaSymbol{())}\<%
\\
%
\>[2]\AgdaFunction{incQtTx}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}%
\>[28]\AgdaSymbol{\AgdaUnderscore{}}%
\>[32]\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\end{code}
%</incQtTx>

%<*incFees>
\begin{code}%
%
\>[2]\AgdaFunction{incFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{∀}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Time}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{List}\AgdaSpace{}%
\AgdaRecord{TXFieldWithId}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{qtTransactions}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{tQtTxs}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{tr}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TXTree}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaBound{inputs}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaBound{qtTransactions}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{\{}\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{VectorOutput}\AgdaSpace{}%
\AgdaBound{time}\AgdaSpace{}%
\AgdaBound{outSize}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSymbol{\}}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{tx}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{TX}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{time}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{block}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{inputs}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{outSize}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{→}\AgdaSpace{}%
\AgdaFunction{Amount}\<%
\\
%
\>[2]\AgdaFunction{incFees}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{\AgdaUnderscore{}\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{amount}\AgdaSymbol{\}}\AgdaSpace{}%
\AgdaSymbol{\{}\AgdaBound{totalFees}\AgdaSymbol{\}}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaInductiveConstructor{normalTX}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{SubInputs}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{txsig}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{}}\AgdaSpace{}%
\AgdaBound{in≥out}\AgdaSymbol{))}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
%
\>[4]\AgdaFunction{txFieldList→TotalAmount}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaFunction{sub→list}\AgdaSpace{}%
\AgdaBound{SubInputs}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaOperator{\AgdaFunction{{-}}}\AgdaSpace{}%
\AgdaBound{amount}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{p≥}}\AgdaSpace{}%
\AgdaBound{in≥out}\<%
\\
%
\>[4]\AgdaOperator{\AgdaField{+}}\AgdaSpace{}%
\AgdaBound{totalFees}\<%
\\
%
\>[2]\AgdaFunction{incFees}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaInductiveConstructor{coinbase}\AgdaSpace{}%
\AgdaBound{tr}\AgdaSpace{}%
\AgdaBound{outputs}\AgdaSpace{}%
\AgdaSymbol{\AgdaUnderscore{})}\AgdaSpace{}%
\AgdaSymbol{=}\AgdaSpace{}%
\AgdaInductiveConstructor{zero}\<%
\end{code}
%</incFees>

%<*outFee>
\begin{code}%
%
\>[2]\AgdaOperator{\AgdaFunction{\AgdaUnderscore{}out≡Fee\AgdaUnderscore{}+RewardBlock\AgdaUnderscore{}}}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaSymbol{(}\AgdaBound{amount}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{)}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaSymbol{(}\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaFunction{Amount}\AgdaSymbol{)}\<%
\\
%
\>[4]\AgdaSymbol{(}\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{:}\AgdaSpace{}%
\AgdaDatatype{Nat}\AgdaSymbol{)}\AgdaSpace{}%
\AgdaSymbol{→}\AgdaSpace{}%
\AgdaPrimitiveType{Set}\<%
\\
%
\>[2]\AgdaBound{amount}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{out≡Fee}}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaOperator{\AgdaFunction{+RewardBlock}}\AgdaSpace{}%
\AgdaBound{block}\AgdaSpace{}%
\AgdaSymbol{=}\<%
\\
\>[2][@{}l@{\AgdaIndent{0}}]%
\>[4]\AgdaBound{amount}\AgdaSpace{}%
\AgdaOperator{\AgdaDatatype{≡}}\AgdaSpace{}%
\AgdaBound{totalFees}\AgdaSpace{}%
\AgdaOperator{\AgdaField{+}}\AgdaSpace{}%
\AgdaFunction{blockReward}\AgdaSpace{}%
\AgdaBound{block}\<%
\end{code}
%</outFee>
